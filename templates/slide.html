<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Slide {{ slide_id + 1 }} of {{ total }}</title>
  <style>
    .progress-bar {
      width: 100%;
      height: 12px;
      background-color: #e0e0e0;
      border-radius: 6px;
      overflow: hidden;
      margin-bottom: 10px;
    }
    .progress-fill {
      height: 100%;
      background-color: #4caf50;
      transition: width 0.3s ease-in-out;
    }
  </style>
</head>
<body style="font-family: sans-serif; padding: 20px;">

<!-- 📈 Progress Tracker + Dropdown -->
<div style="display: flex; justify-content: space-between; align-items: center;">
  <h2>Slide {{ slide_id + 1 }} of {{ total }} ({{ ((slide_id + 1) / total * 100) | round(0) }}%)</h2>
  <form onchange="goToSlide(this)">
    <select name="slideSelect" style="padding: 5px;">
      {% for i in range(total) %}
        <option value="{{ i }}" {% if i == slide_id %}selected{% endif %}>Go to Slide {{ i + 1 }}</option>
      {% endfor %}
    </select>
  </form>
</div>

<div class="progress-bar">
  <div class="progress-fill" style="width: {{ ((slide_id + 1) / total * 100) }}%;"></div>
</div>

{% if image %}
  <img src="{{ image }}" style="max-width:100%; border-radius:8px; margin-bottom:20px;">
{% endif %}

<h3>AI Explanation:</h3>
<div style="background:#f5f5f5; padding:10px; border-radius:8px;">
  {{ explanation|safe }}
  <br>
  <button onclick="speak(document.getElementById('explanationText').innerText)">🔊 Speak Explanation</button>
  <div id="explanationText" style="display:none;">{{ explanation|striptags }}</div>
</div>

<h4>Ask a Question:</h4>
<form method="post" action="/ask">
  <input type="hidden" name="slide_index" value="{{ slide_id }}">
  <input type="text" id="questionInput" name="question" placeholder="Ask a question about this slide" required style="width: 70%;">
  <input type="submit" value="Ask">
</form>

{% if answer %}
  <div style="background:#e6ffe6; padding:10px; border-radius:8px; margin-top:10px;">
    <strong>Your Question:</strong> {{ question }}<br>
    <strong>AI Answer:</strong> {{ answer|safe }}
    <br>
    <button onclick="speak(document.getElementById('answerText').innerText)">🔊 Speak Answer</button>
    <div id="answerText" style="display:none;">{{ answer|striptags }}</div>
  </div>
{% endif %}

<h4>🧠 Flashcards:</h4>
<div style="background:#eef6ff; padding:10px; border-radius:8px;">
  {{ flashcard|safe }}
  <br>
  <button onclick="speak(document.getElementById('flashcardText').innerText)">🔊 Speak Flashcards</button>
  <button onclick="downloadFlashcards()">💾 Download Flashcards</button>
  <div id="flashcardText" style="display:none;">{{ flashcard|striptags }}</div>
</div>

<!-- 🔇 Stop Button -->
<div style="margin-top: 15px;">
  <button onclick="stopSpeaking()">❌ Stop Speaking</button>
</div>

<!-- Navigation -->
<div style="margin-top:20px;">
  {% if slide_id > 0 %}
    <a href="/slide/{{ slide_id - 1 }}">← Previous</a>
  {% endif %}
  {% if slide_id + 1 < total %}
    <a href="/slide/{{ slide_id + 1 }}" style="float:right;">Next →</a>
  {% endif %}
</div>

<!-- JavaScript -->
<script>
function speak(text) {
  stopSpeaking();
  const msg = new SpeechSynthesisUtterance(text);
  msg.lang = 'en-US';
  window.speechSynthesis.speak(msg);
}

function stopSpeaking() {
  window.speechSynthesis.cancel();
}

function downloadFlashcards() {
  const text = document.getElementById('flashcardText').innerText;
  const blob = new Blob([text], { type: 'text/plain' });
  const link = document.createElement("a");
  link.href = URL.createObjectURL(blob);
  link.download = `flashcards_slide_{{ slide_id + 1 }}.txt`;
  link.click();
}

function goToSlide(form) {
  const index = form.slideSelect.value;
  window.location.href = "/slide/" + index;
}
</script>

</body>
</html>
